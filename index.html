<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Master</title>
<!--
  à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰ Google Fonts à¹€à¸¥à¸¢ â†’ à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰ 100% à¸šà¸™ GitHub Pages
  à¹ƒà¸Šà¹‰ system font stack à¹à¸—à¸™:
  - Display/Mono â†’ Courier New / Monaco / Consolas (à¸—à¸¸à¸ OS à¸¡à¸µ)
  - Thai body text â†’ system-ui / Arial (à¸£à¸­à¸‡à¸£à¸±à¸šà¸ à¸²à¸©à¸²à¹„à¸—à¸¢à¸—à¸¸à¸ platform)
-->
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:     #080c14;
  --panel:  #0d1421;
  --border: #1a2a4a;
  --accent: #00d4ff;
  --green:  #a8ff3e;
  --pink:   #ff3e9d;
  --orange: #ff6b35;
  --text:   #e8f4ff;
  --dim:    #4a7090;
  --easy:   #a8ff3e;
  --hard:   #ff3e9d;

/* Font stacks â€” à¹„à¸¡à¹ˆà¸à¸¶à¹ˆà¸‡ Google Fonts */
â€“font-display: â€˜Courier Newâ€™, Courier, â€˜Lucida Consoleâ€™, Monaco, Consolas, monospace;
â€“font-body:    system-ui, -apple-system, â€˜Segoe UIâ€™, Arial, sans-serif;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

- { margin: 0; padding: 0; box-sizing: border-box; }

body {
background: var(â€“bg);
color: var(â€“text);
font-family: var(â€“font-body);
min-height: 100vh;
overflow-x: hidden;
}

body::before {
content: â€˜â€™;
position: fixed; inset: 0;
background:
radial-gradient(ellipse 60% 40% at 20% 20%, rgba(0,212,255,.08) 0%, transparent 70%),
radial-gradient(ellipse 50% 50% at 80% 80%, rgba(168,255,62,.05) 0%, transparent 70%);
pointer-events: none; z-index: 0;
}

.grid-bg {
position: fixed; inset: 0;
background-image:
linear-gradient(rgba(0,212,255,.03) 1px, transparent 1px),
linear-gradient(90deg, rgba(0,212,255,.03) 1px, transparent 1px);
background-size: 40px 40px;
pointer-events: none; z-index: 0;
}

#app { position: relative; z-index: 1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SCREEN SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen { display: none; min-height: 100vh; padding: 20px; }
.screen.active { display: flex; flex-direction: column; align-items: center; justify-content: center; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HOME â€” LOGO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.logo {
font-family: var(â€“font-display);
font-size: clamp(2rem, 8vw, 4.5rem);
font-weight: 900;
letter-spacing: .12em;
text-align: center;
/* à¹ƒà¸Šà¹‰ color + text-shadow à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ â€” à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰ background-clip (Chrome iOS à¸šà¸¥à¹‡à¸­à¸) */
color: var(â€“accent);
text-shadow:
0 0 20px rgba(0,212,255,.7),
0 0 40px rgba(0,212,255,.35),
0 0 60px rgba(168,255,62,.2);
margin-bottom: 6px;
line-height: 1.1;
}

.logo-sub {
font-family: var(â€“font-display);
font-size: .72rem;
color: var(â€“dim);
letter-spacing: .35em;
text-align: center;
text-transform: uppercase;
margin-bottom: 28px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HOME â€” TOPIC SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-label {
width: 100%; max-width: 520px;
display: flex; align-items: center; justify-content: space-between;
margin-bottom: 8px;
}
.sec-label-text { font-size: .7rem; letter-spacing: .15em; color: var(â€“dim); text-transform: uppercase; }

.btn-selall {
font-size: .68rem; color: var(â€“accent);
background: none; border: 1px solid var(â€“border); border-radius: 6px;
padding: 3px 10px; cursor: pointer; font-family: var(â€“font-body);
transition: all .15s;
}
.btn-selall:hover { border-color: var(â€“accent); background: rgba(0,212,255,.07); }

.topic-grid {
display: grid; grid-template-columns: repeat(3, 1fr);
gap: 8px; width: 100%; max-width: 520px; margin-bottom: 8px;
}

.topic-card {
background: var(â€“panel);
border: 2px solid var(â€“border);
border-radius: 11px;
padding: 13px 8px;
text-align: center;
cursor: pointer;
transition: all .18s;
position: relative;
user-select: none;
}
.topic-card:hover { transform: translateY(-2px); box-shadow: 0 4px 14px rgba(0,0,0,.5); }
.topic-card.selected { background: #0f1e30; }
.topic-card.selected::after {
content: â€˜âœ“â€™;
position: absolute; top: 5px; right: 7px;
font-size: .68rem; font-weight: 900; color: var(â€“green);
text-shadow: 0 0 6px rgba(168,255,62,.9);
}
.topic-card.unselected { opacity: .35; filter: grayscale(.6); }
.topic-card.unselected:hover { opacity: .58; filter: grayscale(.3); }

.topic-icon  { font-size: 1.4rem; display: block; margin-bottom: 4px; }
.topic-name  { font-size: .8rem; font-weight: 700; }
.topic-desc  { font-size: .62rem; color: var(â€“dim); margin-top: 2px; line-height: 1.3; }

.tag-new {
display: inline-block; font-size: .5rem;
background: var(â€“pink); color: #fff;
border-radius: 3px; padding: 1px 4px;
vertical-align: middle; margin-left: 2px; font-weight: 700;
}

.warn-text { font-size: .74rem; color: var(â€“hard); text-align: center; margin-bottom: 8px; min-height: 1.1em; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HOME â€” MODE BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mode-section { width: 100%; max-width: 520px; margin-bottom: 18px; }
.mode-label { font-size: .7rem; letter-spacing: .2em; color: var(â€“dim); text-align: center; margin-bottom: 8px; text-transform: uppercase; }
.mode-btns  { display: grid; grid-template-columns: 1fr 1fr; gap: 9px; }

.btn-mode {
padding: 15px;
border: 2px solid var(â€“border); border-radius: 11px;
background: var(â€“panel); color: var(â€“text);
font-family: var(â€“font-body); font-size: .98rem; font-weight: 700;
cursor: pointer; transition: all .2s; line-height: 1.3;
}
.btn-mode.easy { border-color: var(â€“easy); color: var(â€“easy); }
.btn-mode.hard { border-color: var(â€“hard); color: var(â€“hard); }
.btn-mode:hover { transform: scale(1.03); }
.btn-mode.easy:hover { background: rgba(168,255,62,.1); box-shadow: 0 0 18px rgba(168,255,62,.22); }
.btn-mode.hard:hover { background: rgba(255,62,157,.1); box-shadow: 0 0 18px rgba(255,62,157,.22); }
.mode-info { font-size: .65rem; font-weight: 400; opacity: .7; display: block; margin-top: 2px; }

.btn-history {
background: transparent; border: 1px solid var(â€“border);
color: var(â€“dim); padding: 9px 26px; border-radius: 8px;
cursor: pointer; font-family: var(â€“font-body); font-size: .85rem; transition: all .2s;
}
.btn-history:hover { border-color: var(â€“accent); color: var(â€“accent); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game-screen { padding: 14px; }

.game-header {
width: 100%; max-width: 560px;
display: flex; align-items: center; justify-content: space-between;
margin-bottom: 11px;
}
.lives { display: flex; gap: 4px; }
.heart { font-size: 1.15rem; transition: all .3s; }
.heart.lost { opacity: .2; filter: grayscale(1); }

.score-display { font-family: var(â€“font-display); font-size: 1.35rem; font-weight: 700; color: var(â€“accent); }
.streak-display { font-size: .76rem; color: var(â€“dim); }
.streak-display span { color: var(â€“green); font-weight: 700; }

.mode-badge { font-size: .73rem; font-weight: 700; }
.q-count   { font-size: .63rem; color: var(â€“dim); margin-top: 2px; }

/* Timer */
.timer-wrap { width: 100%; max-width: 560px; margin-bottom: 13px; }
.timer-bar-bg { height: 5px; background: var(â€“border); border-radius: 3px; overflow: hidden; }
.timer-bar {
height: 100%; border-radius: 3px;
transition: width .1s linear, background .5s;
background: var(â€“easy);
}
.timer-num { font-family: var(â€“font-display); font-size: .7rem; color: var(â€“dim); text-align: right; margin-top: 3px; }

/* Question box */
.question-box {
width: 100%; max-width: 560px;
background: var(â€“panel); border: 1px solid var(â€“border); border-radius: 14px;
padding: 26px 20px; margin-bottom: 12px; text-align: center;
position: relative; overflow: hidden;
}
.question-box::before {
content: â€˜â€™; position: absolute; inset: 0;
background: linear-gradient(135deg, rgba(0,212,255,.03), transparent);
}
.q-topic-badge {
display: inline-block; font-size: .66rem; letter-spacing: .15em;
padding: 3px 12px; border-radius: 20px; border: 1px solid;
margin-bottom: 13px; text-transform: uppercase; font-weight: 700;
}
.q-text {
font-size: clamp(1.4rem, 5vw, 2.4rem);
font-family: var(â€“font-display);
font-weight: 700; line-height: 1.3; margin-bottom: 6px; color: var(â€“text);
}

/* Answer buttons */
.answer-grid {
width: 100%; max-width: 560px;
display: grid; grid-template-columns: 1fr 1fr;
gap: 8px; margin-bottom: 13px;
}
.btn-answer {
background: var(â€“panel); border: 2px solid var(â€“border);
color: var(â€“text); font-family: var(â€“font-display);
font-size: .96rem; font-weight: 700;
padding: 15px 10px; border-radius: 11px;
cursor: pointer; transition: all .15s;
}
.btn-answer:hover:not(:disabled) {
border-color: var(â€“accent); background: rgba(0,212,255,.08); transform: scale(1.02);
}
.btn-answer:disabled { cursor: not-allowed; }
.btn-answer.correct {
border-color: var(â€“green); background: rgba(168,255,62,.15); color: var(â€“green);
animation: pulseC .4s ease;
}
.btn-answer.wrong {
border-color: var(â€“hard); background: rgba(255,62,157,.15); color: var(â€“hard);
animation: shakeX .4s ease;
}
@keyframes pulseC { 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }
@keyframes shakeX { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }

.btn-quit {
background: transparent; border: 1px solid var(â€“border);
color: var(â€“dim); padding: 7px 22px; border-radius: 8px;
cursor: pointer; font-family: var(â€“font-body); font-size: .82rem; transition: all .2s;
}
.btn-quit:hover { border-color: var(â€“hard); color: var(â€“hard); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESULT SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.result-box { width: 100%; max-width: 450px; text-align: center; }

.result-title {
font-family: var(â€“font-display);
font-size: clamp(1.1rem, 4vw, 1.8rem); font-weight: 900; margin-bottom: 6px;
}
.result-score {
font-family: var(â€“font-display);
font-size: clamp(3rem, 12vw, 5rem); font-weight: 900; line-height: 1;
color: var(â€“accent);
text-shadow: 0 0 20px rgba(0,212,255,.6), 0 0 40px rgba(0,212,255,.3);
margin: 12px 0;
}

.result-stats { display: grid; grid-template-columns: repeat(3,1fr); gap: 7px; margin: 13px 0; }
.stat-card { background: var(â€“panel); border: 1px solid var(â€“border); border-radius: 9px; padding: 11px 5px; }
.stat-val  { font-family: var(â€“font-display); font-size: 1.2rem; font-weight: 700; }
.stat-lbl  { font-size: .63rem; color: var(â€“dim); margin-top: 3px; letter-spacing: .1em; text-transform: uppercase; }

.new-record {
display: none;
background: linear-gradient(135deg, rgba(168,255,62,.1), rgba(0,212,255,.1));
border: 1px solid var(â€“green); border-radius: 9px;
padding: 9px; font-size: .82rem; color: var(â€“green);
margin-bottom: 10px; font-weight: 700;
animation: glow 1.5s ease infinite alternate;
}
@keyframes glow {
from { box-shadow: 0 0 5px rgba(168,255,62,.2); }
to   { box-shadow: 0 0 22px rgba(168,255,62,.55); }
}

.result-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 9px; margin-top: 13px; }

.btn-primary {
background: linear-gradient(135deg, var(â€“accent), rgba(0,170,210,.85));
border: none; color: #000;
font-family: var(â€“font-body); font-size: .96rem; font-weight: 700;
padding: 13px; border-radius: 9px; cursor: pointer; transition: all .2s;
}
.btn-primary:hover { transform: scale(1.03); box-shadow: 0 0 18px rgba(0,212,255,.4); }

.btn-secondary {
background: var(â€“panel); border: 1px solid var(â€“border);
color: var(â€“text); font-family: var(â€“font-body);
font-size: .96rem; padding: 13px; border-radius: 9px; cursor: pointer; transition: all .2s;
}
.btn-secondary:hover { border-color: var(â€“accent); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HISTORY SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.history-box { width: 100%; max-width: 500px; }
.history-title {
font-family: var(â€“font-display); font-size: 1.3rem; font-weight: 900;
color: var(â€“accent); text-align: center; margin-bottom: 4px;
}
.history-sub { font-size: .72rem; color: var(â€“dim); text-align: center; margin-bottom: 16px; }

.history-list { list-style: none; display: flex; flex-direction: column; gap: 6px; }
.history-item {
background: var(â€“panel); border: 1px solid var(â€“border); border-radius: 9px;
padding: 11px 13px;
display: grid; grid-template-columns: 28px 1fr auto; align-items: center; gap: 8px;
transition: border-color .2s;
}
.history-item:hover { border-color: var(â€“accent); }

.h-rank { font-family: var(â€“font-display); font-size: .8rem; font-weight: 700; color: var(â€“dim); }
.h-rank.gold   { color: #ffd700; }
.h-rank.silver { color: #c0c0c0; }
.h-rank.bronze { color: #cd7f32; }

.h-score { font-family: var(â€“font-display); font-size: 1.1rem; font-weight: 700; color: var(â€“accent); }
.h-meta  { font-size: .65rem; color: var(â€“dim); margin-top: 2px; }

.h-badge { font-size: .59rem; padding: 2px 7px; border-radius: 20px; border: 1px solid; font-weight: 700; white-space: nowrap; }
.h-badge.easy { border-color: var(â€“easy); color: var(â€“easy); }
.h-badge.hard { border-color: var(â€“hard); color: var(â€“hard); }

.empty-hist { text-align: center; padding: 36px; color: var(â€“dim); font-size: .85rem; }
.empty-hist .big { font-size: 2.2rem; display: block; margin-bottom: 10px; }

.btn-clear {
background: transparent; border: 1px solid var(â€“border);
color: var(â€“dim); padding: 7px 14px; border-radius: 7px;
cursor: pointer; font-family: var(â€“font-body); font-size: .73rem;
transition: all .2s; white-space: nowrap;
}
.btn-clear:hover { border-color: var(â€“hard); color: var(â€“hard); }
.btn-clear.confirm-state { border-color: #ff8c00; color: #ff8c00; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
QUIT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
display: none; position: fixed; inset: 0;
background: rgba(8,12,20,.9); z-index: 1000;
align-items: center; justify-content: center;
backdrop-filter: blur(6px);
}
.modal-overlay.show { display: flex; }
.modal-box {
background: #0f1a2e; border: 1px solid #2a3a5a; border-radius: 15px;
padding: 28px 24px; text-align: center; max-width: 290px; width: 90%;
animation: fadeUp .2s ease;
}
.modal-title { font-family: var(â€“font-display); font-size: 1rem; font-weight: 700; margin-bottom: 9px; }
.modal-text  { font-size: .85rem; color: var(â€“dim); margin-bottom: 20px; line-height: 1.5; }
.modal-btns  { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

.btn-mcancel {
background: var(â€“panel); border: 1px solid var(â€“border); color: var(â€“text);
font-family: var(â€“font-body); font-size: .9rem; padding: 10px;
border-radius: 8px; cursor: pointer; transition: all .2s;
}
.btn-mcancel:hover { border-color: var(â€“accent); }
.btn-mconfirm {
background: var(â€“hard); border: none; color: #fff;
font-family: var(â€“font-body); font-size: .9rem; font-weight: 700;
padding: 10px; border-radius: 8px; cursor: pointer; transition: all .2s;
}
.btn-mconfirm:hover { opacity: .85; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MISC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.feedback-flash { position: fixed; inset: 0; pointer-events: none; z-index: 100; opacity: 0; transition: opacity .15s; }
.feedback-flash.show { opacity: 1; }
.correct-flash { background: rgba(168,255,62,.06); }
.wrong-flash   { background: rgba(255,62,157,.08); }

.fade-in { animation: fadeUp .3s ease; }
@keyframes fadeUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
</style>

</head>
<body>
<div class="grid-bg"></div>
<div id="app">

<!-- Flash overlay -->

<div class="feedback-flash" id="flash"></div>

<!-- â•â•â•â• QUIT MODAL â•â•â•â• -->

<div class="modal-overlay" id="quit-modal">
  <div class="modal-box">
    <div class="modal-title">âš ï¸ à¸­à¸­à¸à¸ˆà¸²à¸à¹€à¸à¸¡?</div>
    <div class="modal-text">à¸„à¸°à¹à¸™à¸™à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¸ˆà¸°à¸«à¸²à¸¢à¹„à¸›<br>à¹à¸™à¹ˆà¹ƒà¸ˆà¸§à¹ˆà¸²à¸ˆà¸°à¸­à¸­à¸?</div>
    <div class="modal-btns">
      <button class="btn-mcancel" onclick="closeModal()">à¹€à¸¥à¹ˆà¸™à¸•à¹ˆà¸­</button>
      <button class="btn-mconfirm" onclick="doQuit()">à¸­à¸­à¸à¹€à¸¥à¸¢</button>
    </div>
  </div>
</div>

<!-- â•â•â•â• HOME â•â•â•â• -->

<div class="screen active" id="home-screen">
  <div class="logo">MATH MASTER</div>
  <div class="logo-sub">à¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸£à¸°à¸”à¸±à¸šà¸›à¸£à¸¡à¸²à¸ˆà¸²à¸£à¸¢à¹Œ</div>

  <div class="sec-label">
    <span class="sec-label-text">ğŸ“š à¹€à¸¥à¸·à¸­à¸à¸«à¸¡à¸§à¸” (à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸/à¸¢à¸à¹€à¸¥à¸´à¸)</span>
    <button class="btn-selall" id="btn-selall" onclick="toggleAll()">à¸¢à¸à¹€à¸¥à¸´à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
  </div>

  <div class="topic-grid" id="topic-grid"></div>
  <div class="warn-text" id="warn-text"></div>

  <div class="mode-section">
    <div class="mode-label">à¹€à¸¥à¸·à¸­à¸à¹‚à¸«à¸¡à¸”</div>
    <div class="mode-btns">
      <button class="btn-mode easy" onclick="startGame('easy')">
        âš¡ à¸‡à¹ˆà¸²à¸¢<span class="mode-info">â± 20 à¸§à¸´ &nbsp;â¤ï¸â¤ï¸â¤ï¸ 3 à¸Šà¸µà¸§à¸´à¸•</span>
      </button>
      <button class="btn-mode hard" onclick="startGame('hard')">
        ğŸ”¥ à¸¢à¸²à¸<span class="mode-info">â± 10 à¸§à¸´ &nbsp;â¤ï¸â¤ï¸ 2 à¸Šà¸µà¸§à¸´à¸•</span>
      </button>
    </div>
  </div>

<button class="btn-history" onclick="showHistory()">ğŸ† à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸„à¸°à¹à¸™à¸™ Top 10</button>

</div>

<!-- â•â•â•â• GAME â•â•â•â• -->

<div class="screen" id="game-screen">
  <div class="game-header">
    <div>
      <div class="lives" id="lives-display"></div>
      <div class="streak-display" style="margin-top:4px">Streak: <span id="streak-num">0</span></div>
    </div>
    <div style="text-align:center">
      <div class="score-display" id="score-display">0</div>
      <div style="font-size:.62rem;color:var(--dim)">à¸„à¸°à¹à¸™à¸™</div>
    </div>
    <div style="text-align:right">
      <div class="mode-badge" id="mode-badge"></div>
      <div class="q-count">à¸‚à¹‰à¸­à¸—à¸µà¹ˆ <span id="q-num">1</span></div>
    </div>
  </div>

  <div class="timer-wrap">
    <div class="timer-bar-bg"><div class="timer-bar" id="timer-bar"></div></div>
    <div class="timer-num" id="timer-num">20s</div>
  </div>

  <div class="question-box">
    <div class="q-topic-badge" id="q-badge">à¸«à¸±à¸§à¸‚à¹‰à¸­</div>
    <div class="q-text" id="q-text">â€”</div>
  </div>

  <div class="answer-grid" id="answer-grid"></div>
  <button class="btn-quit" onclick="openQuitModal()">âœ• à¸­à¸­à¸à¸ˆà¸²à¸à¹€à¸à¸¡</button>
</div>

<!-- â•â•â•â• RESULT â•â•â•â• -->

<div class="screen" id="result-screen">
  <div class="result-box fade-in">
    <div class="result-title" id="result-title">à¹€à¸à¸¡à¸ˆà¸š!</div>
    <div class="result-score" id="result-score">0</div>
    <div class="new-record" id="new-record">ğŸ† à¸ªà¸–à¸´à¸•à¸´à¹ƒà¸«à¸¡à¹ˆ! à¸•à¸´à¸”à¸­à¸±à¸™à¸”à¸±à¸š Top 10</div>
    <div class="result-stats">
      <div class="stat-card"><div class="stat-val" id="stat-correct">0</div><div class="stat-lbl">à¸•à¸­à¸šà¸–à¸¹à¸</div></div>
      <div class="stat-card"><div class="stat-val" id="stat-streak">0</div><div class="stat-lbl">Streak à¸ªà¸¹à¸‡à¸ªà¸¸à¸”</div></div>
      <div class="stat-card"><div class="stat-val" id="stat-mode">â€”</div><div class="stat-lbl">à¹‚à¸«à¸¡à¸”</div></div>
    </div>
    <div class="result-btns">
      <button class="btn-primary"   onclick="restartGame()">ğŸ”„ à¹€à¸¥à¹ˆà¸™à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡</button>
      <button class="btn-secondary" onclick="goHome()">ğŸ  à¸«à¸™à¹‰à¸²à¹à¸£à¸</button>
    </div>
    <button class="btn-secondary" onclick="showHistory()" style="width:100%;margin-top:9px">ğŸ† à¸”à¸¹à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸„à¸°à¹à¸™à¸™</button>
  </div>
</div>

<!-- â•â•â•â• HISTORY â•â•â•â• -->

<div class="screen" id="history-screen">
  <div class="history-box fade-in">
    <div class="history-title">ğŸ† TOP 10</div>
    <div class="history-sub">à¸ªà¸–à¸´à¸•à¸´à¸ªà¸¹à¸‡à¸ªà¸¸à¸”à¸•à¸¥à¸­à¸”à¸à¸²à¸¥ â€” à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¡à¹‰à¸›à¸´à¸”à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œ</div>
    <ul class="history-list" id="history-list"></ul>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn-secondary" onclick="goHome()" style="flex:1">â† à¸à¸¥à¸±à¸šà¸«à¸™à¹‰à¸²à¹à¸£à¸</button>
      <button class="btn-clear" id="clear-btn" onclick="clearHistory()">ğŸ—‘ à¸¥à¹‰à¸²à¸‡à¸ªà¸–à¸´à¸•à¸´</button>
    </div>
  </div>
</div>

</div><!-- /#app -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<script>
'use strict';

/* â”€â”€ TOPIC DEFINITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const TOPICS = [
  { id:'power',   icon:'âš¡', name:'à¸¢à¸à¸à¸³à¸¥à¸±à¸‡',     desc:'nÂ², nÂ³, aÂ²Â±bÂ²',           color:'#ff6b35', isNew:false },
  { id:'sqrt',    icon:'âˆš',  name:'à¸£à¸²à¸à¸—à¸µà¹ˆà¸ªà¸­à¸‡',   desc:'âˆšn, âˆšaÂ±âˆšb, âˆšnÃ—k',         color:'#00d4ff', isNew:false },
  { id:'percent', icon:'%',  name:'à¹€à¸›à¸­à¸£à¹Œà¹€à¸‹à¹‡à¸™à¸•à¹Œ', desc:'x%à¸‚à¸­à¸‡y, à¸¥à¸”, à¸«à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”',  color:'#a8ff3e', isNew:false },
  { id:'series',  icon:'â€¦',  name:'à¸­à¸™à¸¸à¸à¸£à¸¡',       desc:'à¹€à¸¥à¸‚à¸„à¸“à¸´à¸•, à¹€à¸£à¸‚à¸²à¸„à¸“à¸´à¸•, à¸Ÿà¸µà¹‚à¸š', color:'#ff3e9d', isNew:false },
  { id:'log',     icon:'ã’', name:'à¸¥à¸­à¸à¸²à¸£à¸´à¸—à¸¶à¸¡',   desc:'logâ‚‚, logâ‚ƒ, logâ‚â‚€',        color:'#ffd700', isNew:true  },
  { id:'trig',    icon:'ã€œ', name:'à¸•à¸£à¸µà¹‚à¸à¸“à¸¡à¸´à¸•à¸´',  desc:'sin, cos, tan',             color:'#b388ff', isNew:true  },
  { id:'calc',    icon:'âˆ«',  name:'à¹à¸„à¸¥à¸„à¸¹à¸¥à¸±à¸ª',    desc:'à¸­à¸™à¸¸à¸à¸±à¸™à¸˜à¹Œ, à¸›à¸£à¸´à¸à¸±à¸™à¸˜à¹Œ',       color:'#ff8a65', isNew:true  },
  { id:'sum',     icon:'âˆ‘',  name:'à¸œà¸¥à¸£à¸§à¸¡',        desc:'Î£k, Î£kÂ², à¸Šà¸¸à¸”à¹€à¸£à¸‚à¸²à¸„à¸“à¸´à¸•',    color:'#4dd0e1', isNew:true  },
  { id:'numth',   icon:'ğŸ”¢', name:'à¸—à¸¤à¸©à¸à¸µà¸ˆà¸³à¸™à¸§à¸™', desc:'à¸«.à¸£.à¸¡., à¸„.à¸£.à¸™., à¸•à¸±à¸§à¸«à¸²à¸£',  color:'#81c784', isNew:true  },
];

let selectedTopics = new Set(TOPICS.map(t => t.id));

function renderTopicGrid() {
  const grid = document.getElementById('topic-grid');
  grid.innerHTML = TOPICS.map(t => {
    const sel = selectedTopics.has(t.id);
    const borderStyle = sel ? `border-color:${t.color};box-shadow:0 0 10px ${t.color}30` : '';
    return `<div class="topic-card ${sel ? 'selected' : 'unselected'}"
                 data-id="${t.id}" style="${borderStyle}"
                 onclick="toggleTopic('${t.id}')">
      <span class="topic-icon">${t.icon}</span>
      <div class="topic-name">${t.name}${t.isNew ? '<span class="tag-new">NEW</span>' : ''}</div>
      <div class="topic-desc">${t.desc}</div>
    </div>`;
  }).join('');

  const btn = document.getElementById('btn-selall');
  if (btn) btn.textContent = selectedTopics.size === TOPICS.length ? 'à¸¢à¸à¹€à¸¥à¸´à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”' : 'à¹€à¸¥à¸·à¸­à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”';
}

function toggleTopic(id) {
  if (selectedTopics.has(id)) {
    if (selectedTopics.size <= 1) {
      showWarn('âš ï¸ à¸•à¹‰à¸­à¸‡à¹€à¸¥à¸·à¸­à¸à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸«à¸¡à¸§à¸”');
      return;
    }
    selectedTopics.delete(id);
  } else {
    selectedTopics.add(id);
  }
  clearWarn();
  renderTopicGrid();
}

function toggleAll() {
  if (selectedTopics.size === TOPICS.length) {
    selectedTopics = new Set([TOPICS[0].id]);
  } else {
    selectedTopics = new Set(TOPICS.map(t => t.id));
  }
  renderTopicGrid();
}

let warnTO = null;
function showWarn(msg) {
  const el = document.getElementById('warn-text');
  el.textContent = msg;
  clearTimeout(warnTO);
  warnTO = setTimeout(() => { el.textContent = ''; }, 2200);
}
function clearWarn() { document.getElementById('warn-text').textContent = ''; }

/* â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const MODES = { easy: { time:20, lives:3 }, hard: { time:10, lives:2 } };
let gs = {}, timerInterval = null, currentMode = 'easy';
let clearConfirm = false, clearTO = null;

/* â”€â”€ MATH HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const ri   = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;
const pick  = arr   => arr[ri(0, arr.length - 1)];
const r2    = n     => Math.round(n * 100) / 100;
const gcd   = (a,b) => b === 0 ? a : gcd(b, a % b);
const lcm   = (a,b) => a * b / gcd(a, b);

/* â”€â”€ QUESTION GENERATORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const GENS = {
  power(h) {
    const t = ri(1,3);
    if (t===1) { const a=h?ri(8,25):ri(2,12); return { text:`${a}Â²`, answer:a*a }; }
    if (t===2) { const a=h?ri(4,12):ri(2,7);  return { text:`${a}Â³`, answer:a**3 }; }
    const a=h?ri(6,15):ri(3,9), b=h?ri(2,8):ri(1,5), op=Math.random()>.5?'+':'âˆ’';
    return { text:`${a}Â² ${op} ${b}Â²`, answer: op==='+'?a*a+b*b:a*a-b*b };
  },
  sqrt(h) {
    const P = h ? [144,169,196,225,256,289,324,361,400,441,484,529] : [4,9,16,25,36,49,64,81,100,121,144];
    const t = ri(1,3);
    if (t===1) { const n=pick(P); return { text:`âˆš${n}`, answer:Math.sqrt(n) }; }
    if (t===2) {
      const p1=pick(P), p2=pick(P), op=Math.random()>.5?'+':'âˆ’';
      const ans = op==='+'?Math.sqrt(p1)+Math.sqrt(p2):Math.sqrt(p1)-Math.sqrt(p2);
      if (!Number.isInteger(ans)||ans<0) return GENS.sqrt(h);
      return { text:`âˆš${p1} ${op} âˆš${p2}`, answer:ans };
    }
    const p=pick(P), k=h?ri(3,8):ri(2,5);
    return { text:`âˆš${p} Ã— ${k}`, answer:Math.sqrt(p)*k };
  },
  percent(h) {
    const t = ri(1,3);
    if (t===1) {
      const pcts=h?[7,12,15,17,22,35,45,65,75]:[10,20,25,30,50,75];
      const p=pick(pcts), base=h?ri(2,20)*50:ri(1,10)*100;
      return { text:`${p}% à¸‚à¸­à¸‡ ${base}`, answer:p*base/100 };
    }
    if (t===2) {
      const d=pick(h?[15,18,22,35,45]:[10,20,25,30]);
      const price=h?ri(4,20)*100:ri(2,10)*100;
      return { text:`à¸£à¸²à¸„à¸² ${price}à¸š à¸¥à¸” ${d}%`, answer:price-price*d/100 };
    }
    const p=pick(h?[8,12,15,18,24]:[10,20,25,50]);
    const part=h?ri(3,15)*p:ri(1,8)*p;
    return { text:`${part} à¸„à¸·à¸­ ${p}% à¸‚à¸­à¸‡ ?`, answer:part*100/p };
  },
  series(h) {
    const t = ri(1,4);
    if (t===1) {
      const s=h?ri(5,50):ri(1,20), d=h?ri(5,25):ri(2,10);
      const seq=[s,s+d,s+2*d,s+3*d,s+4*d], pos=ri(1,4);
      return { text:seq.map((v,i)=>i===pos?'?':v).join(', '), answer:seq[pos] };
    }
    if (t===2) {
      const s=h?ri(2,6):ri(1,4), r=h?ri(3,5):ri(2,3);
      const seq=[s,s*r,s*r**2,s*r**3,s*r**4], pos=ri(1,3);
      return { text:seq.map((v,i)=>i===pos?'?':v).join(', '), answer:seq[pos] };
    }
    if (t===3) {
      const a=h?ri(3,10):ri(1,5), b=h?ri(4,12):ri(2,6);
      const seq=[a,b,a+b,a+2*b,2*a+3*b], pos=ri(2,4);
      return { text:seq.map((v,i)=>i===pos?'?':v).join(', '), answer:seq[pos] };
    }
    const off=h?ri(2,8):0, seq=[1,4,9,16,25,36].map(x=>x+off), pos=ri(1,4);
    return { text:seq.map((v,i)=>i===pos?'?':v).join(', '), answer:seq[pos] };
  },
  log(h) {
    const t = ri(1,3);
    if (t===1) { const b=pick(h?[2,3,4,5,8]:[2,3,10]), n=h?ri(2,8):ri(1,5); return { text:`log${b}(${b**n})`, answer:n }; }
    if (t===2) { const n=h?ri(-1,5):ri(1,4); return { text:`logâ‚â‚€(${10**n})`, answer:n }; }
    const n=h?ri(2,8):ri(1,5); return { text:`logâ‚‚(${2**n})`, answer:n };
  },
  trig(h) {
    const T = {
      sin:{ 0:0, 30:0.5, 45:0.71, 60:0.87, 90:1, 120:0.87, 150:0.5, 180:0 },
      cos:{ 0:1, 30:0.87, 45:0.71, 60:0.5, 90:0, 120:-0.5, 150:-0.87, 180:-1 },
      tan:{ 0:0, 30:0.58, 45:1, 60:1.73, 180:0 },
    };
    const fns = h ? ['sin','cos','tan'] : ['sin','cos'];
    const fn = pick(fns);
    const angles = Object.keys(T[fn]).map(Number).filter(a => h || a <= 90);
    const angle = pick(angles);
    return { text:`${fn}(${angle}Â°)`, answer:T[fn][angle] };
  },
  calc(h) {
    const t = ri(1,2);
    if (t===1) {
      const a=h?ri(2,8):ri(1,5), n=h?ri(2,5):ri(2,4);
      return { text:`d/dx[${a}x^${n}] à¸—à¸µà¹ˆ x=1`, answer:a*n };
    }
    const a=h?ri(2,8):ri(1,5), n=h?ri(1,4):ri(1,3);
    return { text:`âˆ«â‚€Â¹ ${a}x^${n} dx`, answer:r2(a/(n+1)) };
  },
  sum(h) {
    const t = ri(1,3);
    if (t===1) { const n=h?ri(10,30):ri(3,10); return { text:`Î£k  (k=1â†’${n})`, answer:n*(n+1)/2 }; }
    if (t===2) { const n=h?ri(5,10):ri(3,6);   return { text:`Î£kÂ²  (k=1â†’${n})`, answer:n*(n+1)*(2*n+1)/6 }; }
    const a=pick([1,2,3]), r=pick([2,3]), n=h?ri(4,7):ri(3,5);
    return { text:`${a}+${a*r}+${a*r**2}+â€¦ (${n}à¸à¸ˆà¸™à¹Œ)`, answer:a*(r**n-1)/(r-1) };
  },
  numth(h) {
    const t = ri(1,3);
    if (t===1) { const a=h?ri(12,80):ri(4,24), b=h?ri(6,50):ri(2,18); return { text:`à¸«.à¸£.à¸¡.(${a}, ${b})`, answer:gcd(a,b) }; }
    if (t===2) { const a=h?ri(4,15):ri(2,8), b=h?ri(4,15):ri(2,8); return { text:`à¸„.à¸£.à¸™.(${a}, ${b})`, answer:lcm(a,b) }; }
    const n=pick(h?[36,48,60,72,100,120]:[6,8,9,10,12,15,16,18,20]);
    let cnt=0; for (let i=1;i<=n;i++) if(n%i===0) cnt++;
    return { text:`${n} à¸¡à¸µà¸•à¸±à¸§à¸«à¸²à¸£à¸à¸µà¹ˆà¸•à¸±à¸§?`, answer:cnt };
  },
};

function genQuestion(hard) {
  const ids = [...selectedTopics];
  let q, att = 0;
  do {
    const id = pick(ids);
    const meta = TOPICS.find(t => t.id === id);
    q = GENS[id](hard);
    q.topic      = meta.name;
    q.topicColor = meta.color;
    q.topicIcon  = meta.icon;
    q.answer     = r2(q.answer);
    att++;
  } while (att < 15 && (!isFinite(q.answer) || q.answer < 0));
  return q;
}

function genChoices(ans, hard) {
  const s = new Set([ans]); let att = 0;
  while (s.size < 4 && att++ < 500) {
    let delta;
    if (Number.isInteger(ans)) {
      const range = hard ? Math.max(15, Math.round(Math.abs(ans) * .35)) : Math.max(8, Math.round(Math.abs(ans) * .3));
      delta = ri(-range, range) || pick([-1,1,2,-2,3,-3,5,-5]);
    } else {
      delta = pick([-1,1,-.5,.5,-.25,.25,-.33,.33,-.58,.58,-.87,.87,-1.73,1.73]);
    }
    const c = r2(ans + delta);
    if (c !== ans && isFinite(c)) s.add(c);
  }
  return shuffle([...s]);
}

function shuffle(a) {
  for (let i=a.length-1; i>0; i--) {
    const j = ri(0, i); [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* â”€â”€ SCREEN NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function goHome() { clearInterval(timerInterval); closeModal(); showScreen('home-screen'); renderTopicGrid(); }
function showHistory() { renderHistory(); showScreen('history-screen'); }
function openQuitModal() { document.getElementById('quit-modal').classList.add('show'); }
function closeModal()    { document.getElementById('quit-modal').classList.remove('show'); }
function doQuit()        { clearInterval(timerInterval); closeModal(); showScreen('home-screen'); renderTopicGrid(); }

/* â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getH()    { try { return JSON.parse(localStorage.getItem('mm_v3') || '[]'); } catch { return []; } }
function saveH(h)  { localStorage.setItem('mm_v3', JSON.stringify(h)); }
function isTop(s)  { const h=getH(); return h.length < 10 || s > h[h.length-1].score; }
function addRec(r) { let h=getH(); h.push(r); h.sort((a,b)=>b.score-a.score); saveH(h.slice(0,10)); }

function renderHistory() {
  const h = getH(), list = document.getElementById('history-list');
  if (!h.length) {
    list.innerHTML = `<div class="empty-hist"><span class="big">ğŸ®</span>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸–à¸´à¸•à¸´<br>à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¡à¹€à¸à¸·à¹ˆà¸­à¸ªà¸£à¹‰à¸²à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´!</div>`;
    return;
  }
  const rl = { 0:'ğŸ¥‡', 1:'ğŸ¥ˆ', 2:'ğŸ¥‰' };
  list.innerHTML = h.map((r,i) => {
    const rc = i===0?'gold':i===1?'silver':i===2?'bronze':'';
    const dt = new Date(r.date);
    const ds = `${dt.getDate()}/${dt.getMonth()+1}/${String(dt.getFullYear()).slice(2)} ${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}`;
    return `<li class="history-item">
      <div class="h-rank ${rc}">${i<3 ? rl[i] : '#'+(i+1)}</div>
      <div>
        <div class="h-score">${r.score} <span style="font-size:.72rem;color:var(--dim)">à¸„à¸°à¹à¸™à¸™</span></div>
        <div class="h-meta">âœ… ${r.correct} à¸–à¸¹à¸ &nbsp;ğŸ”¥ Streak ${r.maxStreak} &nbsp;ğŸ“… ${ds}</div>
      </div>
      <div class="h-badge ${r.mode}">${r.mode==='easy'?'à¸‡à¹ˆà¸²à¸¢':'à¸¢à¸²à¸'}</div>
    </li>`;
  }).join('');
}

function clearHistory() {
  const btn = document.getElementById('clear-btn');
  if (clearConfirm) {
    localStorage.removeItem('mm_v3'); renderHistory();
    clearConfirm = false; btn.textContent = 'ğŸ—‘ à¸¥à¹‰à¸²à¸‡à¸ªà¸–à¸´à¸•à¸´'; btn.classList.remove('confirm-state');
    clearTimeout(clearTO);
  } else {
    clearConfirm = true; btn.textContent = 'âš ï¸ à¸à¸”à¸¢à¸·à¸™à¸¢à¸±à¸™'; btn.classList.add('confirm-state');
    clearTO = setTimeout(() => { clearConfirm=false; btn.textContent='ğŸ—‘ à¸¥à¹‰à¸²à¸‡à¸ªà¸–à¸´à¸•à¸´'; btn.classList.remove('confirm-state'); }, 3000);
  }
}

/* â”€â”€ GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startGame(mode) {
  if (selectedTopics.size === 0) { showWarn('âš ï¸ à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸«à¸¡à¸§à¸”'); return; }
  currentMode = mode;
  const cfg = MODES[mode];
  gs = { mode, score:0, correct:0, lives:cfg.lives, maxLives:cfg.lives, streak:0, maxStreak:0, qNum:1, answered:false, currentQ:null };
  showScreen('game-screen');
  updateHUD();
  nextQ();
}
function restartGame() { startGame(currentMode); }

function updateHUD() {
  document.getElementById('score-display').textContent = gs.score;
  document.getElementById('streak-num').textContent    = gs.streak;
  document.getElementById('q-num').textContent         = gs.qNum;
  const mb = document.getElementById('mode-badge');
  mb.textContent = gs.mode==='easy' ? 'âš¡ à¸‡à¹ˆà¸²à¸¢' : 'ğŸ”¥ à¸¢à¸²à¸';
  mb.style.color = gs.mode==='easy' ? 'var(--easy)' : 'var(--hard)';
  document.getElementById('lives-display').innerHTML =
    Array.from({ length:gs.maxLives }, (_,i) =>
      `<span class="heart ${i >= gs.lives ? 'lost' : ''}">â¤ï¸</span>`
    ).join('');
}

function nextQ() {
  clearInterval(timerInterval);
  gs.answered = false;
  gs.currentQ = genQuestion(gs.mode === 'hard');
  const q = gs.currentQ;
  const choices = genChoices(q.answer, gs.mode === 'hard');

  const badge = document.getElementById('q-badge');
  badge.textContent  = `${q.topicIcon} ${q.topic}`;
  badge.style.borderColor = q.topicColor;
  badge.style.color       = q.topicColor;
  document.getElementById('q-text').textContent = q.text;

  document.getElementById('answer-grid').innerHTML = choices.map(c => {
    const d = Number.isInteger(c) ? c : c.toFixed(2);
    return `<button class="btn-answer" onclick="doAnswer(this,${c})">${d}</button>`;
  }).join('');

  gs.timeLeft = MODES[gs.mode].time;
  updateTimerUI();
  timerInterval = setInterval(() => {
    gs.timeLeft = r2(gs.timeLeft - .1);
    if (gs.timeLeft <= 0) { gs.timeLeft = 0; timeUp(); }
    updateTimerUI();
  }, 100);
}

function updateTimerUI() {
  const pct = (gs.timeLeft / MODES[gs.mode].time) * 100;
  const bar = document.getElementById('timer-bar');
  bar.style.width      = pct + '%';
  bar.style.background = pct > 50 ? 'var(--easy)' : pct > 25 ? '#ffcc00' : 'var(--hard)';
  document.getElementById('timer-num').textContent = Math.ceil(gs.timeLeft) + 's';
}

function doAnswer(btn, val) {
  if (gs.answered) return;
  gs.answered = true;
  clearInterval(timerInterval);
  const correct = val === gs.currentQ.answer;
  document.querySelectorAll('.btn-answer').forEach(b => {
    b.disabled = true;
    if (parseFloat(b.textContent) === gs.currentQ.answer) b.classList.add('correct');
  });
  if (correct) {
    btn.classList.add('correct');
    gs.score += 10 + Math.round(gs.timeLeft) + (gs.streak >= 3 ? gs.streak * 5 : 0);
    gs.correct++; gs.streak++;
    if (gs.streak > gs.maxStreak) gs.maxStreak = gs.streak;
    flash('correct');
  } else {
    btn.classList.add('wrong');
    gs.lives--; gs.streak = 0;
    flash('wrong');
  }
  updateHUD();
  setTimeout(() => { if (gs.lives <= 0) { endGame(); return; } gs.qNum++; nextQ(); }, 900);
}

function timeUp() {
  if (gs.answered) return;
  gs.answered = true; clearInterval(timerInterval);
  gs.lives--; gs.streak = 0;
  document.querySelectorAll('.btn-answer').forEach(b => {
    b.disabled = true;
    if (parseFloat(b.textContent) === gs.currentQ.answer) b.classList.add('correct');
  });
  flash('wrong'); updateHUD();
  setTimeout(() => { if (gs.lives <= 0) { endGame(); return; } gs.qNum++; nextQ(); }, 900);
}

function flash(t) {
  const f = document.getElementById('flash');
  f.className = `feedback-flash ${t}-flash show`;
  setTimeout(() => f.classList.remove('show'), 300);
}

function endGame() {
  clearInterval(timerInterval);
  const rec = { score:gs.score, correct:gs.correct, maxStreak:gs.maxStreak, mode:gs.mode, date:Date.now() };
  const isNew = isTop(gs.score);
  if (isNew) addRec(rec);
  document.getElementById('result-score').textContent = gs.score;
  document.getElementById('stat-correct').textContent = gs.correct;
  document.getElementById('stat-streak').textContent  = gs.maxStreak;
  document.getElementById('stat-mode').textContent    = gs.mode==='easy' ? 'à¸‡à¹ˆà¸²à¸¢' : 'à¸¢à¸²à¸';
  document.getElementById('result-title').textContent =
    gs.score > 150 ? 'ğŸ‰ à¸¢à¸­à¸”à¹€à¸¢à¸µà¹ˆà¸¢à¸¡!' : gs.score > 80 ? 'ğŸ‘ à¸”à¸µà¸¡à¸²à¸!' : gs.score > 30 ? 'ğŸ’ª à¸à¸¶à¸à¸•à¹ˆà¸­à¹„à¸›!' : 'ğŸ“š à¸¥à¸­à¸‡à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡!';
  document.getElementById('new-record').style.display = isNew ? 'block' : 'none';
  showScreen('result-screen');
}

/* â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
renderTopicGrid();
</script>

</body>
</html>
